---
layout: yard_main
title: "Class: Google::Cloud::Spanner::Client - Google"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::Spanner::Client";
  relpath = '../../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span>
     &raquo; 
    <span class="title">Client</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Class: Google::Cloud::Spanner::Client
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Google::Cloud::Spanner::Client</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/spanner/client.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h1>Client</h1>

<p>A client is used to read and/or modify data in a Cloud Spanner database.</p>

<p>See <span class='object_link'><a href="Project.html#client-instance_method" title="Google::Cloud::Spanner::Project#client (method)">Project#client</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tx'>tx</span><span class='op'>|</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">#<strong>close</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Closes the client connection and releases resources.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#commit-instance_method" title="#commit (instance method)">#<strong>commit</strong> {|commit| ... } &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates and commits a transaction for writes that execute atomically at a single logical point in time across columns, rows, and tables in a database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#commit_timestamp-instance_method" title="#commit_timestamp (instance method)">#<strong>commit_timestamp</strong>  &#x21d2; ColumnValue </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a column value object representing setting a field&#39;s value to the timestamp of the commit.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#database-instance_method" title="#database (instance method)">#<strong>database</strong>  &#x21d2; Database </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The Spanner database connected to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#database_id-instance_method" title="#database_id (instance method)">#<strong>database_id</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The unique identifier for the database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">#<strong>delete</strong>(table, keys = [])  &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Deletes rows from a table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_partition_update-instance_method" title="#execute_partition_update (instance method)">#<strong>execute_partition_update</strong>(sql, params: nil, types: nil)  &#x21d2; Integer </a>
    

    
      (also: #execute_pdml)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Executes a Partitioned DML SQL statement.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute_query-instance_method" title="#execute_query (instance method)">#<strong>execute_query</strong>(sql, params: nil, types: nil, single_use: nil)  &#x21d2; Google::Cloud::Spanner::Results </a>
    

    
      (also: #execute, #query, #execute_sql)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Executes a SQL query.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fields-instance_method" title="#fields (instance method)">#<strong>fields</strong>(types)  &#x21d2; Fields </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a configuration object (<span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span>) that may be provided to queries or used to create STRUCT objects.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#insert-instance_method" title="#insert (instance method)">#<strong>insert</strong>(table, *rows)  &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Inserts new rows in a table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#instance-instance_method" title="#instance (instance method)">#<strong>instance</strong>  &#x21d2; Instance </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The Spanner instance connected to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#instance_id-instance_method" title="#instance_id (instance method)">#<strong>instance_id</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The unique identifier for the instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#project-instance_method" title="#project (instance method)">#<strong>project</strong>  &#x21d2; Project </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The Spanner project connected to.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#project_id-instance_method" title="#project_id (instance method)">#<strong>project_id</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The unique identifier for the project.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#range-instance_method" title="#range (instance method)">#<strong>range</strong>(beginning, ending, exclude_begin: false, exclude_end: false)  &#x21d2; Google::Cloud::Spanner::Range </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a Spanner Range.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read-instance_method" title="#read (instance method)">#<strong>read</strong>(table, columns, keys: nil, index: nil, limit: nil, single_use: nil)  &#x21d2; Google::Cloud::Spanner::Results </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Read rows from a database table, as a simple alternative to <span class='object_link'><a href="#execute_query-instance_method" title="Google::Cloud::Spanner::Client#execute_query (method)">#execute_query</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace-instance_method" title="#replace (instance method)">#<strong>replace</strong>(table, *rows)  &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Inserts or replaces rows in a table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#snapshot-instance_method" title="#snapshot (instance method)">#<strong>snapshot</strong>(strong: nil, timestamp: nil, read_timestamp: nil, staleness: nil, exact_staleness: nil) {|snapshot| ... } &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a snapshot read-only transaction for reads that execute atomically at a single logical point in time across columns, rows, and tables in a database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#transaction-instance_method" title="#transaction (instance method)">#<strong>transaction</strong>(deadline: 120) {|transaction| ... } &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a transaction for reads and writes that execute atomically at a single logical point in time across columns, rows, and tables in a database.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>(table, *rows)  &#x21d2; Time </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Updates existing rows in a table.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#upsert-instance_method" title="#upsert (instance method)">#<strong>upsert</strong>(table, *rows)  &#x21d2; Time </a>
    

    
      (also: #save)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Inserts or updates rows in a table.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="close-instance_method">
  
    #<strong>close</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Closes the client connection and releases resources.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1273
1274
1275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 1273</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="commit-instance_method">
  
    #<strong>commit</strong> {|commit| ... } &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates and commits a transaction for writes that execute atomically
at a single logical point in time across columns, rows, and tables in
a database.</p>

<p>All changes are accumulated in memory until the block completes.
Unlike <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>, which can also perform reads, this operation
accepts only mutations and makes a single API request.</p>

<p><strong>Note:</strong> This method does not feature replay protection present in
<span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>. This method makes a single RPC, whereas <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>
requires two RPCs (one of which may be performed in advance), and so
this method may be appropriate for latency sensitive and/or high
throughput blind changes.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_commit'>commit</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="#commit-instance_method" title="Google::Cloud::Spanner::Client#commit (method)">commit</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The block for mutating the data.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>commit</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Commit.html" title="Google::Cloud::Spanner::Commit (class)">Google::Cloud::Spanner::Commit</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Commit object.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the operation committed.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


915
916
917
918
919
920
921</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 915</span>

<span class='kw'>def</span> <span class='id identifier rubyid_commit'>commit</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Must provide a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_commit'>commit</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="commit_timestamp-instance_method">
  
    #<strong>commit_timestamp</strong>  &#x21d2; <tt><span class='object_link'><a href="ColumnValue.html" title="Google::Cloud::Spanner::ColumnValue (class)">ColumnValue</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a column value object representing setting a field&#39;s value to
the timestamp of the commit. (See <span class='object_link'><a href="ColumnValue.html#commit_timestamp-class_method" title="Google::Cloud::Spanner::ColumnValue.commit_timestamp (method)">Google::Cloud::Spanner::ColumnValue.commit_timestamp</a></span>)</p>

<p>This placeholder value can only be used for timestamp columns that
have set the option &quot;(allow_commit_timestamp=true)&quot; in the schema.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># create column value object
</span><span class='id identifier rubyid_commit_timestamp'>commit_timestamp</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_commit_timestamp'>commit_timestamp</span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_commit'>commit</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span>
    <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>5</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Murphy</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>updated_at:</span> <span class='id identifier rubyid_commit_timestamp'>commit_timestamp</span> <span class='rbrace'>}</span>
  <span class='rbracket'>]</span>
<span class='kw'>end</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="ColumnValue.html" title="Google::Cloud::Spanner::ColumnValue (class)">ColumnValue</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The commit timestamp column value object.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1266
1267
1268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 1266</span>

<span class='kw'>def</span> <span class='id identifier rubyid_commit_timestamp'>commit_timestamp</span>
  <span class='const'><span class='object_link'><a href="ColumnValue.html" title="Google::Cloud::Spanner::ColumnValue (class)">ColumnValue</a></span></span><span class='period'>.</span><span class='id identifier rubyid_commit_timestamp'><span class='object_link'><a href="ColumnValue.html#commit_timestamp-class_method" title="Google::Cloud::Spanner::ColumnValue.commit_timestamp (method)">commit_timestamp</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="database-instance_method">
  
    #<strong>database</strong>  &#x21d2; <tt><span class='object_link'><a href="Database.html" title="Google::Cloud::Spanner::Database (class)">Database</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The Spanner database connected to.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Database.html" title="Google::Cloud::Spanner::Database (class)">Database</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_database'>database</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_database'>database</span> <span class='id identifier rubyid_instance_id'>instance_id</span><span class='comma'>,</span> <span class='id identifier rubyid_database_id'>database_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="database_id-instance_method">
  
    #<strong>database_id</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The unique identifier for the database.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_database_id'>database_id</span>
  <span class='ivar'>@database_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete-instance_method">
  
    #<strong>delete</strong>(table, keys = [])  &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Deletes rows from a table. Succeeds whether or not the specified rows
were present.</p>

<p>Changes are made immediately upon calling this method using a
single-use transaction. To make multiple changes in the same
single-use transaction use <span class='object_link'><a href="#commit-instance_method" title="Google::Cloud::Spanner::Client#commit (method)">#commit</a></span>. To make changes in a transaction
that supports reads and automatic retry protection use <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>.</p>

<p><strong>Note:</strong> This method does not feature replay protection present in
<span class='object_link'><a href="Transaction.html#delete-instance_method" title="Google::Cloud::Spanner::Transaction#delete (method)">Transaction#delete</a></span> (See <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>). This method makes a single
RPC, whereas <span class='object_link'><a href="Transaction.html#delete-instance_method" title="Google::Cloud::Spanner::Transaction#delete (method)">Transaction#delete</a></span> requires two RPCs (one of which may
be performed in advance), and so this method may be appropriate for
latency sensitive and/or high throughput blind deletions.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
modified.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>Array&lt;Object&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A single, or list of keys or key
ranges to match returned data to. Values should have exactly as many
elements as there are columns in the primary key.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the operation committed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


877
878
879
880
881</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 877</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_keys'>keys</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_partition_update-instance_method">
  
    #<strong>execute_partition_update</strong>(sql, params: nil, types: nil)  &#x21d2; <tt>Integer</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='execute_pdml-instance_method'>execute_pdml</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Executes a Partitioned DML SQL statement.</p>

<p>Partitioned DML is an alternate implementation with looser semantics
to enable large-scale changes without running into transaction size
limits or (accidentally) locking the entire table in one large
transaction. At a high level, it partitions the keyspace and executes
the statement on each partition in separate internal transactions.</p>

<p>Partitioned DML does not guarantee database-wide atomicity of the
statement - it guarantees row-based atomicity, which includes updates
to any indices. Additionally, it does not guarantee that it will
execute exactly one time against each row - it guarantees &quot;at least
once&quot; semantics.</p>

<p>Where DML statements must be executed using Transaction (see
<span class='object_link'><a href="Transaction.html#execute_update-instance_method" title="Google::Cloud::Spanner::Transaction#execute_update (method)">Transaction#execute_update</a></span>), Paritioned DML statements are executed
outside of a read/write transaction.</p>

<p>Not all DML statements can be executed in the Partitioned DML mode and
the backend will return an error for the statements which are not
supported.</p>

<p>DML statements must be fully-partitionable. Specifically, the
statement must be expressible as the union of many statements which
each access only a single row of the table.
InvalidArgumentError is raised if the statement does
not qualify.</p>

<p>The method will block until the update is complete. Running a DML
statement with this method does not offer exactly once semantics, and
therefore the DML statement should be idempotent. The DML statement
must be fully-partitionable. Specifically, the statement must be
expressible as the union of many statements which each access only a
single row of the table. This is a Partitioned DML transaction in
which a single Partitioned DML statement is executed. Partitioned DML
partitions the and runs the DML statement over each partition in
parallel using separate, internal transactions that commit
independently. Partitioned DML transactions do not need to be
committed.</p>

<p>Partitioned DML updates are used to execute a single DML statement
with a different execution strategy that provides different, and often
better, scalability properties for large, table-wide operations than
DML in a <span class='object_link'><a href="Transaction.html#execute_update-instance_method" title="Google::Cloud::Spanner::Transaction#execute_update (method)">Transaction#execute_update</a></span> transaction. Smaller scoped
statements, such as an OLTP workload, should prefer using
<span class='object_link'><a href="Transaction.html#execute_update-instance_method" title="Google::Cloud::Spanner::Transaction#execute_update (method)">Transaction#execute_update</a></span>.</p>

<p>That said, Partitioned DML is not a drop-in replacement for standard
DML used in <span class='object_link'><a href="Transaction.html#execute_update-instance_method" title="Google::Cloud::Spanner::Transaction#execute_update (method)">Transaction#execute_update</a></span>.</p>

<ul>
<li>The DML statement must be fully-partitionable. Specifically, the
statement must be expressible as the union of many statements which
each access only a single row of the table.</li>
<li>The statement is not applied atomically to all rows of the table.
Rather, the statement is applied atomically to partitions of the
table, in independent internal transactions. Secondary index rows
are updated atomically with the base table rows.</li>
<li>Partitioned DML does not guarantee exactly-once execution semantics
against a partition. The statement will be applied at least once to
each partition. It is strongly recommended that the DML statement
should be idempotent to avoid unexpected results. For instance, it
is potentially dangerous to run a statement such as <code>UPDATE table
SET column = column + 1</code> as it could be run multiple times against
some rows.</li>
<li>The partitions are committed automatically - there is no support for
Commit or Rollback. If the call returns an error, or if the client
issuing the DML statement dies, it is possible that some rows had
the statement executed on them successfully. It is also possible
that statement was never executed against other rows.</li>
<li>If any error is encountered during the execution of the partitioned
DML operation (for instance, a UNIQUE INDEX violation, division by
zero, or a value that cannot be stored due to schema constraints),
then the operation is stopped at that point and an error is
returned. It is possible that at this point, some partitions have
been committed (or even committed multiple times), and other
partitions have not been run at all.</li>
</ul>

<p>Given the above, Partitioned DML is good fit for large, database-wide,
operations that are idempotent, such as deleting old rows from a very
large table.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_row_count'>row_count</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition_update'>execute_partition_update</span> \
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPDATE users SET friends = NULL WHERE active = false</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Query using query parameters:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_row_count'>row_count</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_partition_update'>execute_partition_update</span> \
 <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPDATE users SET friends = NULL WHERE active = @active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
 <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sql</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Partitioned DML statement string. See <a href="https://cloud.google.com/spanner/docs/query-syntax">Query
syntax</a>.</p>

<p>The Partitioned DML statement string can contain parameter
placeholders. A parameter placeholder consists of &quot;@&quot; followed by
the parameter name. Parameter names consist of any combination of
letters, numbers, and underscores.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Parameters for the Partitioned DML statement
string. The parameter placeholders, minus the &quot;@&quot;, are the the hash
keys, and the literal values are the hash values. If the query
string contains something like &quot;WHERE id &gt; @msg_id&quot;, then the params
must contain something like <code>:msg_id =&gt; 1</code>.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
<tr>
<td><code>STRUCT</code></td>
<td><code>Hash</code>, <span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span></td>
<td></td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>

<p>See <a href="https://cloud.google.com/spanner/docs/data-types#constructing-a-struct">Data Types - Constructing a
STRUCT</a>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>types</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Types of the SQL parameters in <code>params</code>. It is not
always possible for Cloud Spanner to infer the right SQL type from a
value in <code>params</code>. In these cases, the <code>types</code> hash can be used to
specify the exact SQL type for some or all of the SQL query
parameters.</p>

<p>The keys of the hash should be query string parameter placeholders,
minus the &quot;@&quot;. The values of the hash should be Cloud Spanner type
codes from the following list:</p>

<ul>
<li><code>:BOOL</code></li>
<li><code>:BYTES</code></li>
<li><code>:DATE</code></li>
<li><code>:FLOAT64</code></li>
<li><code>:INT64</code></li>
<li><code>:STRING</code></li>
<li><code>:TIMESTAMP</code></li>
<li><code>Array</code> - Lists are specified by providing the type code in an
array. For example, an array of integers are specified as
<code>[:INT64]</code>.</li>
<li><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> - Nested Structs are specified by providing a Fields
object.</li>
</ul>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The lower bound number of rows that were modified.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 484</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_partition_update'>execute_partition_update</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_ensure_service!'>ensure_service!</span>

  <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_input_params_and_types'>to_input_params_and_types</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span>

  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span> \
      <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='id identifier rubyid_types'>types</span><span class='comma'>,</span>
           <span class='label'>transaction:</span> <span class='id identifier rubyid_pdml_transaction'>pdml_transaction</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='comment'># Stream all PartialResultSet to get ResultSetStats
</span>  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
  <span class='comment'># Raise an error if there is not a row count returned
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_row_count'>row_count</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>InvalidArgumentError</span><span class='comma'>,</span>
          <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Partitioned DML statement is invalid.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_row_count'>row_count</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="execute_query-instance_method">
  
    #<strong>execute_query</strong>(sql, params: nil, types: nil, single_use: nil)  &#x21d2; <tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='execute-instance_method'>execute</span>, <span id='query-instance_method'>query</span>, <span id='execute_sql-instance_method'>execute_sql</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Executes a SQL query.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Query using query parameters:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE active = @active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Query with a SQL STRUCT query parameter as a Hash:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_user_hash'>user_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID = @user_struct.id </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND name = @user_struct.name </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND active = @user_struct.active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_hash'>user_hash</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Specify the SQL STRUCT type using Fields object:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_user_type'>user_type</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='label'>id:</span> <span class='symbol'>:INT64</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='symbol'>:STRING</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='symbol'>:BOOL</span>
<span class='id identifier rubyid_user_hash'>user_hash</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID = @user_struct.id </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND name = @user_struct.name </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND active = @user_struct.active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_hash'>user_hash</span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='label'>types:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_type'>user_type</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Or, query with a SQL STRUCT as a typed Data object:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_user_type'>user_type</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='label'>id:</span> <span class='symbol'>:INT64</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='symbol'>:STRING</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='symbol'>:BOOL</span>
<span class='id identifier rubyid_user_data'>user_data</span> <span class='op'>=</span> <span class='id identifier rubyid_user_type'>user_type</span><span class='period'>.</span><span class='id identifier rubyid_struct'>struct</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span><span class='lparen'>(</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users WHERE </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ID = @user_struct.id </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND name = @user_struct.name </span><span class='tstring_end'>&quot;</span></span> \
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AND active = @user_struct.active</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='label'>params:</span> <span class='lbrace'>{</span> <span class='label'>user_struct:</span> <span class='id identifier rubyid_user_data'>user_data</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>sql</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The SQL query string. See <a href="https://cloud.google.com/spanner/docs/query-syntax">Query
syntax</a>.</p>

<p>The SQL query string can contain parameter placeholders. A parameter
placeholder consists of &quot;@&quot; followed by the parameter name.
Parameter names consist of any combination of letters, numbers, and
underscores.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>SQL parameters for the query string. The
parameter placeholders, minus the &quot;@&quot;, are the the hash keys, and
the literal values are the hash values. If the query string contains
something like &quot;WHERE id &gt; @msg_id&quot;, then the params must contain
something like <code>:msg_id =&gt; 1</code>.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
<tr>
<td><code>STRUCT</code></td>
<td><code>Hash</code>, <span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span></td>
<td></td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>

<p>See <a href="https://cloud.google.com/spanner/docs/data-types#constructing-a-struct">Data Types - Constructing a
STRUCT</a>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>types</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Types of the SQL parameters in <code>params</code>. It is not
always possible for Cloud Spanner to infer the right SQL type from a
value in <code>params</code>. In these cases, the <code>types</code> hash must be used to
specify the SQL type for these values.</p>

<p>The keys of the hash should be query string parameter placeholders,
minus the &quot;@&quot;. The values of the hash should be Cloud Spanner type
codes from the following list:</p>

<ul>
<li><code>:BOOL</code></li>
<li><code>:BYTES</code></li>
<li><code>:DATE</code></li>
<li><code>:FLOAT64</code></li>
<li><code>:INT64</code></li>
<li><code>:STRING</code></li>
<li><code>:TIMESTAMP</code></li>
<li><code>Array</code> - Lists are specified by providing the type code in an
array. For example, an array of integers are specified as
<code>[:INT64]</code>.</li>
<li><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> - Types for STRUCT values (<code>Hash</code>/<span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span> objects) are
specified using a <span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> object.</li>
</ul>

<p>Types are optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>single_use</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Perform the read with a single-use snapshot
(read-only transaction). (See
<a href="https://cloud.google.com/spanner/docs/reference/rpc/google.spanner.v1#transactionoptions">TransactionOptions</a>.)
The snapshot can be created by providing exactly one of the
following options in the hash:</p>

<ul>
<li><strong>Strong</strong>

<ul>
<li><code>:strong</code> (true, false) Read at a timestamp where all previously
committed transactions are visible.</li>
</ul></li>
<li><p><strong>Exact</strong></p>

<ul>
<li><code>:timestamp</code>/<code>:read_timestamp</code> (Time, DateTime) Executes all
reads at the given timestamp. Unlike other modes, reads at a
specific timestamp are repeatable; the same read at the same
timestamp always returns the same data. If the timestamp is in
the future, the read will block until the specified timestamp,
modulo the read&#39;s deadline.</li>
</ul>

<p>Useful for large scale consistent reads such as mapreduces, or
for coordinating many reads against a consistent snapshot of the
data.</p>

<ul>
<li><code>:staleness</code>/<code>:exact_staleness</code> (Numeric) Executes all reads at
a timestamp that is exactly the number of seconds provided old.
The timestamp is chosen soon after the read is started.</li>
</ul>

<p>Guarantees that all writes that have committed more than the
specified number of seconds ago are visible. Because Cloud
Spanner chooses the exact timestamp, this mode works even if the
client&#39;s local clock is substantially skewed from Cloud Spanner
commit timestamps.</p>

<p>Useful for reading at nearby replicas without the distributed
timestamp negotiation overhead of single-use
<code>bounded_staleness</code>.</p></li>
<li><p><strong>Bounded</strong></p>

<ul>
<li><code>:bounded_timestamp</code>/<code>:min_read_timestamp</code> (Time, DateTime)
Executes all reads at a timestamp greater than the value
provided.</li>
</ul>

<p>This is useful for requesting fresher data than some previous
read, or data that is fresh enough to observe the effects of
some previously committed transaction whose timestamp is known.</p>

<ul>
<li><code>:bounded_staleness</code>/<code>:max_staleness</code> (Numeric) Read data at a
timestamp greater than or equal to the number of seconds
provided. Guarantees that all writes that have committed more
than the specified number of seconds ago are visible. Because
Cloud Spanner chooses the exact timestamp, this mode works even
if the client&#39;s local clock is substantially skewed from Cloud
Spanner commit timestamps.</li>
</ul>

<p>Useful for reading the freshest data available at a nearby
replica, while bounding the possible staleness if the local
replica has fallen behind.</p></li>
</ul>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The results of the query
execution.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311
312
313
314
315
316
317
318
319
320
321
322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_execute_query'>execute_query</span> <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>single_use:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_validate_single_use_args!'>validate_single_use_args!</span> <span class='id identifier rubyid_single_use'>single_use</span>
  <span class='id identifier rubyid_ensure_service!'>ensure_service!</span>

  <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_input_params_and_types'>to_input_params_and_types</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='id identifier rubyid_types'>types</span>

  <span class='id identifier rubyid_single_use_tx'>single_use_tx</span> <span class='op'>=</span> <span class='id identifier rubyid_single_use_transaction'>single_use_transaction</span> <span class='id identifier rubyid_single_use'>single_use</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span> \
      <span class='id identifier rubyid_sql'>sql</span><span class='comma'>,</span> <span class='label'>params:</span> <span class='id identifier rubyid_params'>params</span><span class='comma'>,</span> <span class='label'>types:</span> <span class='id identifier rubyid_types'>types</span><span class='comma'>,</span> <span class='label'>transaction:</span> <span class='id identifier rubyid_single_use_tx'>single_use_tx</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fields-instance_method">
  
    #<strong>fields</strong>(types)  &#x21d2; <tt><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a configuration object (<span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span>) that may be provided to
queries or used to create STRUCT objects. (The STRUCT will be
represented by the <span class='object_link'><a href="Data.html" title="Google::Cloud::Spanner::Data (class)">Data</a></span> class.) See <span class='object_link'><a href="#execute-instance_method" title="Google::Cloud::Spanner::Client#execute (method)">#execute</a></span> and/or
<span class='object_link'><a href="Fields.html#struct-instance_method" title="Google::Cloud::Spanner::Fields#struct (method)">Fields#struct</a></span>.</p>

<p>For more information, see <a href="https://cloud.google.com/spanner/docs/data-types#constructing-a-struct">Data Types - Constructing a
STRUCT</a>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>Create a STRUCT value with named fields using Fields object:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_named_type'>named_type</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span><span class='lparen'>(</span>
  <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='symbol'>:INT64</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='symbol'>:STRING</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='symbol'>:BOOL</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span>
<span class='id identifier rubyid_named_data'>named_data</span> <span class='op'>=</span> <span class='id identifier rubyid_named_type'>named_type</span><span class='period'>.</span><span class='id identifier rubyid_struct'>struct</span><span class='lparen'>(</span>
  <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>42</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span>
<span class='rparen'>)</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Create a STRUCT value with anonymous field names:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_anon_type'>anon_type</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='lbracket'>[</span><span class='symbol'>:INT64</span><span class='comma'>,</span> <span class='symbol'>:STRING</span><span class='comma'>,</span> <span class='symbol'>:BOOL</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_anon_data'>anon_data</span> <span class='op'>=</span> <span class='id identifier rubyid_anon_type'>anon_type</span><span class='period'>.</span><span class='id identifier rubyid_struct'>struct</span> <span class='lbracket'>[</span><span class='int'>42</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Create a STRUCT value with duplicate field names:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_dup_type'>dup_type</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_fields'>fields</span> <span class='lbracket'>[</span><span class='lbracket'>[</span><span class='symbol'>:x</span><span class='comma'>,</span> <span class='symbol'>:INT64</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:x</span><span class='comma'>,</span> <span class='symbol'>:STRING</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:x</span><span class='comma'>,</span> <span class='symbol'>:BOOL</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
<span class='id identifier rubyid_dup_data'>dup_data</span> <span class='op'>=</span> <span class='id identifier rubyid_dup_type'>dup_type</span><span class='period'>.</span><span class='id identifier rubyid_struct'>struct</span> <span class='lbracket'>[</span><span class='int'>42</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>false</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>types</span>
      
      
        <span class='type'>(<tt>Array</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Accepts an array or hash types.</p>

<p>Arrays can contain just the type value, or a sub-array of the
field&#39;s name and type value. Hash keys must contain the field name
as a <code>Symbol</code> or <code>String</code>, or the field position as an <code>Integer</code>.
Hash values must contain the type value. If a Hash is used the
fields will be created using the same order as the Hash keys.</p>

<p>Supported type values incude:</p>

<ul>
<li><code>:BOOL</code></li>
<li><code>:BYTES</code></li>
<li><code>:DATE</code></li>
<li><code>:FLOAT64</code></li>
<li><code>:INT64</code></li>
<li><code>:STRING</code></li>
<li><code>:TIMESTAMP</code></li>
<li><code>Array</code> - Lists are specified by providing the type code in an
array. For example, an array of integers are specified as
<code>[:INT64]</code>.</li>
<li><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span> - Nested Structs are specified by providing a Fields
object.</li>
</ul>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The fields of the given types.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1178
1179
1180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 1178</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fields'>fields</span> <span class='id identifier rubyid_types'>types</span>
  <span class='const'><span class='object_link'><a href="Fields.html" title="Google::Cloud::Spanner::Fields (class)">Fields</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_types'>types</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="insert-instance_method">
  
    #<strong>insert</strong>(table, *rows)  &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Inserts new rows in a table. If any of the rows already exist, the
write or request fails with AlreadyExistsError.</p>

<p>Changes are made immediately upon calling this method using a
single-use transaction. To make multiple changes in the same
single-use transaction use <span class='object_link'><a href="#commit-instance_method" title="Google::Cloud::Spanner::Client#commit (method)">#commit</a></span>. To make changes in a transaction
that supports reads and automatic retry protection use <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>.</p>

<p><strong>Note:</strong> This method does not feature replay protection present in
<span class='object_link'><a href="Transaction.html#insert-instance_method" title="Google::Cloud::Spanner::Transaction#insert (method)">Transaction#insert</a></span> (See <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>). This method makes a single
RPC, whereas <span class='object_link'><a href="Transaction.html#insert-instance_method" title="Google::Cloud::Spanner::Transaction#insert (method)">Transaction#insert</a></span> requires two RPCs (one of which may
be performed in advance), and so this method may be appropriate for
latency sensitive and/or high throughput blind inserts.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                    <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
modified.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rows</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>One or more hash objects with the hash keys
matching the table&#39;s columns, and the hash values matching the
table&#39;s values.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the operation committed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


727
728
729
730
731</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 727</span>

<span class='kw'>def</span> <span class='id identifier rubyid_insert'>insert</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rows'>rows</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_rows'>rows</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="instance-instance_method">
  
    #<strong>instance</strong>  &#x21d2; <tt><span class='object_link'><a href="Instance.html" title="Google::Cloud::Spanner::Instance (class)">Instance</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The Spanner instance connected to.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Instance.html" title="Google::Cloud::Spanner::Instance (class)">Instance</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 90</span>

<span class='kw'>def</span> <span class='id identifier rubyid_instance'>instance</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_instance'>instance</span> <span class='id identifier rubyid_instance_id'>instance_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="instance_id-instance_method">
  
    #<strong>instance_id</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The unique identifier for the instance.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 72</span>

<span class='kw'>def</span> <span class='id identifier rubyid_instance_id'>instance_id</span>
  <span class='ivar'>@instance_id</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="project-instance_method">
  
    #<strong>project</strong>  &#x21d2; <tt><span class='object_link'><a href="Project.html" title="Google::Cloud::Spanner::Project (class)">Project</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The Spanner project connected to.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Project.html" title="Google::Cloud::Spanner::Project (class)">Project</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 84</span>

<span class='kw'>def</span> <span class='id identifier rubyid_project'>project</span>
  <span class='ivar'>@project</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="project_id-instance_method">
  
    #<strong>project_id</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The unique identifier for the project.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 66</span>

<span class='kw'>def</span> <span class='id identifier rubyid_project_id'>project_id</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_service'>service</span><span class='period'>.</span><span class='id identifier rubyid_project'>project</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="range-instance_method">
  
    #<strong>range</strong>(beginning, ending, exclude_begin: false, exclude_end: false)  &#x21d2; <tt><span class='object_link'><a href="Range.html" title="Google::Cloud::Spanner::Range (class)">Google::Cloud::Spanner::Range</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a Spanner Range. This can be used in place of a Ruby Range
when needing to exclude the beginning value.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_key_range'>key_range</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_range'>range</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>100</span>
<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='id identifier rubyid_key_range'>key_range</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>beginning</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The object that defines the beginning of the
range.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>ending</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The object that defines the end of the range.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exclude_begin</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Determines if the range excludes its
beginning value. Default is <code>false</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exclude_end</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Determines if the range excludes its
ending value. Default is <code>false</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Range.html" title="Google::Cloud::Spanner::Range (class)">Google::Cloud::Spanner::Range</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The new Range instance.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1235
1236
1237
1238
1239</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 1235</span>

<span class='kw'>def</span> <span class='id identifier rubyid_range'>range</span> <span class='id identifier rubyid_beginning'>beginning</span><span class='comma'>,</span> <span class='id identifier rubyid_ending'>ending</span><span class='comma'>,</span> <span class='label'>exclude_begin:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>exclude_end:</span> <span class='kw'>false</span>
  <span class='const'><span class='object_link'><a href="Range.html" title="Google::Cloud::Spanner::Range (class)">Range</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span> <span class='id identifier rubyid_beginning'>beginning</span><span class='comma'>,</span> <span class='id identifier rubyid_ending'>ending</span><span class='comma'>,</span>
            <span class='label'>exclude_begin:</span> <span class='id identifier rubyid_exclude_begin'>exclude_begin</span><span class='comma'>,</span>
            <span class='label'>exclude_end:</span> <span class='id identifier rubyid_exclude_end'>exclude_end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="read-instance_method">
  
    #<strong>read</strong>(table, columns, keys: nil, index: nil, limit: nil, single_use: nil)  &#x21d2; <tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Read rows from a database table, as a simple alternative to
<span class='object_link'><a href="#execute_query-instance_method" title="Google::Cloud::Spanner::Client#execute_query (method)">#execute_query</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Use the <code>keys</code> option to pass keys and/or key ranges to read.</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='symbol'>:id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='int'>1</span><span class='op'>..</span><span class='int'>5</span>

<span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
read.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>columns</span>
      
      
        <span class='type'>(<tt>Array&lt;String, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The columns of table to be
returned for each row matching this request.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>Array&lt;Object&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A single, or list of keys or key
ranges to match returned data to. Values should have exactly as many
elements as there are columns in the primary key.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of an index to use instead of the
table&#39;s primary key when interpreting <code>id</code> and sorting result rows.
Optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>limit</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>If greater than zero, no more than this number
of rows will be returned. The default is no limit.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>single_use</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Perform the read with a single-use snapshot
(read-only transaction). (See
<a href="https://cloud.google.com/spanner/docs/reference/rpc/google.spanner.v1#transactionoptions">TransactionOptions</a>.)
The snapshot can be created by providing exactly one of the
following options in the hash:</p>

<ul>
<li><strong>Strong</strong>

<ul>
<li><code>:strong</code> (true, false) Read at a timestamp where all previously
committed transactions are visible.</li>
</ul></li>
<li><p><strong>Exact</strong></p>

<ul>
<li><code>:timestamp</code>/<code>:read_timestamp</code> (Time, DateTime) Executes all
reads at the given timestamp. Unlike other modes, reads at a
specific timestamp are repeatable; the same read at the same
timestamp always returns the same data. If the timestamp is in
the future, the read will block until the specified timestamp,
modulo the read&#39;s deadline.</li>
</ul>

<p>Useful for large scale consistent reads such as mapreduces, or
for coordinating many reads against a consistent snapshot of the
data.</p>

<ul>
<li><code>:staleness</code>/<code>:exact_staleness</code> (Numeric) Executes all reads at
a timestamp that is exactly the number of seconds provided old.
The timestamp is chosen soon after the read is started.</li>
</ul>

<p>Guarantees that all writes that have committed more than the
specified number of seconds ago are visible. Because Cloud
Spanner chooses the exact timestamp, this mode works even if the
client&#39;s local clock is substantially skewed from Cloud Spanner
commit timestamps.</p>

<p>Useful for reading at nearby replicas without the distributed
timestamp negotiation overhead of single-use
<code>bounded_staleness</code>.</p></li>
<li><p><strong>Bounded</strong></p>

<ul>
<li><code>:bounded_timestamp</code>/<code>:min_read_timestamp</code> (Time, DateTime)
Executes all reads at a timestamp greater than the value
provided.</li>
</ul>

<p>This is useful for requesting fresher data than some previous
read, or data that is fresh enough to observe the effects of
some previously committed transaction whose timestamp is known.</p>

<ul>
<li><code>:bounded_staleness</code>/<code>:max_staleness</code> (Numeric) Read data at a
timestamp greater than or equal to the number of seconds
provided. Guarantees that all writes that have committed more
than the specified number of seconds ago are visible. Because
Cloud Spanner chooses the exact timestamp, this mode works even
if the client&#39;s local clock is substantially skewed from Cloud
Spanner commit timestamps.</li>
</ul>

<p>Useful for reading the freshest data available at a nearby
replica, while bounding the possible staleness if the local
replica has fallen behind.</p></li>
</ul>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Results.html" title="Google::Cloud::Spanner::Results (class)">Google::Cloud::Spanner::Results</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The results of the read.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 603</span>

<span class='kw'>def</span> <span class='id identifier rubyid_read'>read</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='kw'>nil</span><span class='comma'>,</span>
         <span class='label'>single_use:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_validate_single_use_args!'>validate_single_use_args!</span> <span class='id identifier rubyid_single_use'>single_use</span>
  <span class='id identifier rubyid_ensure_service!'>ensure_service!</span>

  <span class='id identifier rubyid_columns'>columns</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_columns'>columns</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_to_key_set'>to_key_set</span> <span class='id identifier rubyid_keys'>keys</span>

  <span class='id identifier rubyid_single_use_tx'>single_use_tx</span> <span class='op'>=</span> <span class='id identifier rubyid_single_use_transaction'>single_use_transaction</span> <span class='id identifier rubyid_single_use'>single_use</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span> \
      <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_columns'>columns</span><span class='comma'>,</span> <span class='label'>keys:</span> <span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='label'>index:</span> <span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='label'>limit:</span> <span class='id identifier rubyid_limit'>limit</span><span class='comma'>,</span>
                      <span class='label'>transaction:</span> <span class='id identifier rubyid_single_use_tx'>single_use_tx</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace-instance_method">
  
    #<strong>replace</strong>(table, *rows)  &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Inserts or replaces rows in a table. If any of the rows already exist,
it is deleted, and the column values provided are inserted instead.
Unlike #upsert, this means any values not explicitly written become
<code>NULL</code>.</p>

<p>Changes are made immediately upon calling this method using a
single-use transaction. To make multiple changes in the same
single-use transaction use <span class='object_link'><a href="#commit-instance_method" title="Google::Cloud::Spanner::Client#commit (method)">#commit</a></span>. To make changes in a transaction
that supports reads and automatic retry protection use <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>.</p>

<p><strong>Note:</strong> This method does not feature replay protection present in
<span class='object_link'><a href="Transaction.html#replace-instance_method" title="Google::Cloud::Spanner::Transaction#replace (method)">Transaction#replace</a></span> (See <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>). This method makes a single
RPC, whereas <span class='object_link'><a href="Transaction.html#replace-instance_method" title="Google::Cloud::Spanner::Transaction#replace (method)">Transaction#replace</a></span> requires two RPCs (one of which may
be performed in advance), and so this method may be appropriate for
latency sensitive and/or high throughput blind replaces.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                     <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
modified.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rows</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>One or more hash objects with the hash keys
matching the table&#39;s columns, and the hash values matching the
table&#39;s values.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the operation committed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


839
840
841
842
843</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 839</span>

<span class='kw'>def</span> <span class='id identifier rubyid_replace'>replace</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rows'>rows</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_rows'>rows</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="snapshot-instance_method">
  
    #<strong>snapshot</strong>(strong: nil, timestamp: nil, read_timestamp: nil, staleness: nil, exact_staleness: nil) {|snapshot| ... } &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a snapshot read-only transaction for reads that execute
atomically at a single logical point in time across columns, rows, and
tables in a database. For transactions that only read, snapshot
read-only transactions provide simpler semantics and are almost always
faster than read-write transactions.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_snapshot'>snapshot</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_snp'>snp</span><span class='op'>|</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_snp'>snp</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>strong</span>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Read at a timestamp where all previously
committed transactions are visible.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>timestamp</span>
      
      
        <span class='type'>(<tt>Time</tt>, <tt>DateTime</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Executes all reads at the given
timestamp. Unlike other modes, reads at a specific timestamp are
repeatable; the same read at the same timestamp always returns the
same data. If the timestamp is in the future, the read will block
until the specified timestamp, modulo the read&#39;s deadline.</p>

<p>Useful for large scale consistent reads such as mapreduces, or for
coordinating many reads against a consistent snapshot of the data.
(See
<a href="https://cloud.google.com/spanner/docs/reference/rpc/google.spanner.v1#transactionoptions">TransactionOptions</a>.)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>read_timestamp</span>
      
      
        <span class='type'>(<tt>Time</tt>, <tt>DateTime</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Same as <code>timestamp</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>staleness</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Executes all reads at a timestamp that is
<code>staleness</code> seconds old. For example, the number 10.1 is translated
to 10 seconds and 100 milliseconds.</p>

<p>Guarantees that all writes that have committed more than the
specified number of seconds ago are visible. Because Cloud Spanner
chooses the exact timestamp, this mode works even if the client&#39;s
local clock is substantially skewed from Cloud Spanner commit
timestamps.</p>

<p>Useful for reading at nearby replicas without the distributed
timestamp negotiation overhead of single-use <code>staleness</code>. (See
<a href="https://cloud.google.com/spanner/docs/reference/rpc/google.spanner.v1#transactionoptions">TransactionOptions</a>.)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exact_staleness</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Same as <code>staleness</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="#snapshot-instance_method" title="Google::Cloud::Spanner::Client#snapshot (method)">snapshot</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The block for reading and writing data.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>snapshot</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Snapshot.html" title="Google::Cloud::Spanner::Snapshot (class)">Google::Cloud::Spanner::Snapshot</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The Snapshot
object.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 1082</span>

<span class='kw'>def</span> <span class='id identifier rubyid_snapshot'>snapshot</span> <span class='label'>strong:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timestamp:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>read_timestamp:</span> <span class='kw'>nil</span><span class='comma'>,</span>
             <span class='label'>staleness:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>exact_staleness:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_validate_snapshot_args!'>validate_snapshot_args!</span> <span class='label'>strong:</span> <span class='id identifier rubyid_strong'>strong</span><span class='comma'>,</span> <span class='label'>timestamp:</span> <span class='id identifier rubyid_timestamp'>timestamp</span><span class='comma'>,</span>
                          <span class='label'>read_timestamp:</span> <span class='id identifier rubyid_read_timestamp'>read_timestamp</span><span class='comma'>,</span>
                          <span class='label'>staleness:</span> <span class='id identifier rubyid_staleness'>staleness</span><span class='comma'>,</span>
                          <span class='label'>exact_staleness:</span> <span class='id identifier rubyid_exact_staleness'>exact_staleness</span>

  <span class='id identifier rubyid_ensure_service!'>ensure_service!</span>
  <span class='kw'>unless</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Nested snapshots are not allowed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_snp_grpc'>snp_grpc</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_service'>service</span><span class='period'>.</span><span class='id identifier rubyid_create_snapshot'>create_snapshot</span> \
        <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='label'>strong:</span> <span class='id identifier rubyid_strong'>strong</span><span class='comma'>,</span>
                      <span class='label'>timestamp:</span> <span class='lparen'>(</span><span class='id identifier rubyid_timestamp'>timestamp</span> <span class='op'>||</span> <span class='id identifier rubyid_read_timestamp'>read_timestamp</span><span class='rparen'>)</span><span class='comma'>,</span>
                      <span class='label'>staleness:</span> <span class='lparen'>(</span><span class='id identifier rubyid_staleness'>staleness</span> <span class='op'>||</span> <span class='id identifier rubyid_exact_staleness'>exact_staleness</span><span class='rparen'>)</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_snp_grpc'>snp_grpc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
      <span class='id identifier rubyid_snp'>snp</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Snapshot.html" title="Google::Cloud::Spanner::Snapshot (class)">Snapshot</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from_grpc'>from_grpc</span> <span class='id identifier rubyid_snp_grpc'>snp_grpc</span><span class='comma'>,</span> <span class='id identifier rubyid_session'>session</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_snp'>snp</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>ensure</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="transaction-instance_method">
  
    #<strong>transaction</strong>(deadline: 120) {|transaction| ... } &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a transaction for reads and writes that execute atomically at
a single logical point in time across columns, rows, and tables in a
database.</p>

<p>The transaction will always commit unless an error is raised. If the
error raised is <span class='object_link'><a href="Rollback.html" title="Google::Cloud::Spanner::Rollback (class)">Rollback</a></span> the transaction method will return without
passing on the error. All other errors will be passed on.</p>

<p>All changes are accumulated in memory until the block completes.
Transactions will be automatically retried when possible, until
<code>deadline</code> is reached. This operation makes separate API requests to
begin and commit the transaction.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tx'>tx</span><span class='op'>|</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_execute_query'>execute_query</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT * FROM users</span><span class='tstring_end'>&quot;</span></span>

  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_rows'>rows</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_row'>row</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>User </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_row'>row</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Manually rollback the transaction using <span class='object_link'><a href="Rollback.html" title="Google::Cloud::Spanner::Rollback (class)">Rollback</a></span>:</p>
</div></p>
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>
<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tx'>tx</span><span class='op'>|</span>
  <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_insert'>insert</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_something_wrong?'>something_wrong?</span>
    <span class='comment'># Rollback the transaction without passing on the error
</span>    <span class='comment'># outside of the transaction method.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Rollback.html" title="Google::Cloud::Spanner::Rollback (class)">Rollback</a></span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>deadline</span>
      
      
        <span class='type'>(<tt>Numeric</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The total amount of time in seconds the
transaction has to succeed. The default is <code>120</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">transaction</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The block for reading and writing data.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>transaction</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Transaction.html" title="Google::Cloud::Spanner::Transaction (class)">Google::Cloud::Spanner::Transaction</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The
Transaction object.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the transaction committed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 983</span>

<span class='kw'>def</span> <span class='id identifier rubyid_transaction'>transaction</span> <span class='label'>deadline:</span> <span class='int'>120</span>
  <span class='id identifier rubyid_ensure_service!'>ensure_service!</span>
  <span class='kw'>unless</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Nested transactions are not allowed</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_deadline'>deadline</span> <span class='op'>=</span> <span class='id identifier rubyid_validate_deadline'>validate_deadline</span> <span class='id identifier rubyid_deadline'>deadline</span>
  <span class='id identifier rubyid_backoff'>backoff</span> <span class='op'>=</span> <span class='float'>1.0</span>
  <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='id identifier rubyid_current_time'>current_time</span>

  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_transaction'>with_transaction</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tx'>tx</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_transaction_id'>transaction_id</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_tx'>tx</span>
      <span class='id identifier rubyid_commit_resp'>commit_resp</span> <span class='op'>=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_service'>service</span><span class='period'>.</span><span class='id identifier rubyid_commit'>commit</span> \
        <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_mutations'>mutations</span><span class='comma'>,</span> <span class='label'>transaction_id:</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_transaction_id'>transaction_id</span>
      <span class='kw'>return</span> <span class='const'>Convert</span><span class='period'>.</span><span class='id identifier rubyid_timestamp_to_time'>timestamp_to_time</span> <span class='id identifier rubyid_commit_resp'>commit_resp</span><span class='period'>.</span><span class='id identifier rubyid_commit_timestamp'>commit_timestamp</span>
    <span class='kw'>rescue</span> <span class='const'>GRPC</span><span class='op'>::</span><span class='const'>Aborted</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>AbortedError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_err'>err</span>
      <span class='comment'># Re-raise if deadline has passed
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_current_time'>current_time</span> <span class='op'>-</span> <span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_deadline'>deadline</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'>GRPC</span><span class='op'>::</span><span class='const'>BadStatus</span>
          <span class='id identifier rubyid_err'>err</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>Error</span><span class='period'>.</span><span class='id identifier rubyid_from_error'>from_error</span> <span class='id identifier rubyid_err'>err</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_err'>err</span>
      <span class='kw'>end</span>
      <span class='comment'># Sleep the amount from RetryDelay, or incremental backoff
</span>      <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='id identifier rubyid_delay_from_aborted'>delay_from_aborted</span><span class='lparen'>(</span><span class='id identifier rubyid_err'>err</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_backoff'>backoff</span> <span class='op'>*=</span> <span class='float'>1.3</span><span class='rparen'>)</span>
      <span class='comment'># Create new transaction on the session and retry the block
</span>      <span class='id identifier rubyid_tx'>tx</span> <span class='op'>=</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_create_transaction'>create_transaction</span>
      <span class='kw'>retry</span>
    <span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_err'>err</span>
      <span class='comment'># Rollback transaction when handling unexpected error
</span>      <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_rollback'>rollback</span> <span class='id identifier rubyid_tx'>tx</span><span class='period'>.</span><span class='id identifier rubyid_transaction_id'>transaction_id</span>
      <span class='comment'># Return nil if raised with rollback.
</span>      <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_err'>err</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><span class='object_link'><a href="Rollback.html" title="Google::Cloud::Spanner::Rollback (class)">Rollback</a></span></span>
      <span class='comment'># Re-raise error.
</span>      <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_err'>err</span>
    <span class='kw'>ensure</span>
      <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='symbol'>:transaction_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>(table, *rows)  &#x21d2; <tt>Time</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Updates existing rows in a table. If any of the rows does not already
exist, the request fails with NotFoundError.</p>

<p>Changes are made immediately upon calling this method using a
single-use transaction. To make multiple changes in the same
single-use transaction use <span class='object_link'><a href="#commit-instance_method" title="Google::Cloud::Spanner::Client#commit (method)">#commit</a></span>. To make changes in a transaction
that supports reads and automatic retry protection use <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>.</p>

<p><strong>Note:</strong> This method does not feature replay protection present in
<span class='object_link'><a href="Transaction.html#update-instance_method" title="Google::Cloud::Spanner::Transaction#update (method)">Transaction#update</a></span> (See <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>). This method makes a single
RPC, whereas <span class='object_link'><a href="Transaction.html#update-instance_method" title="Google::Cloud::Spanner::Transaction#update (method)">Transaction#update</a></span> requires two RPCs (one of which may
be performed in advance), and so this method may be appropriate for
latency sensitive and/or high throughput blind updates.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                    <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
modified.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rows</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>One or more hash objects with the hash keys
matching the table&#39;s columns, and the hash values matching the
table&#39;s values.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the operation committed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


782
783
784
785
786</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 782</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rows'>rows</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_rows'>rows</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upsert-instance_method">
  
    #<strong>upsert</strong>(table, *rows)  &#x21d2; <tt>Time</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='save-instance_method'>save</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Inserts or updates rows in a table. If any of the rows already exist,
then its column values are overwritten with the ones provided. Any
column values not explicitly written are preserved.</p>

<p>Changes are made immediately upon calling this method using a
single-use transaction. To make multiple changes in the same
single-use transaction use <span class='object_link'><a href="#commit-instance_method" title="Google::Cloud::Spanner::Client#commit (method)">#commit</a></span>. To make changes in a transaction
that supports reads and automatic retry protection use <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>.</p>

<p><strong>Note:</strong> This method does not feature replay protection present in
<span class='object_link'><a href="Transaction.html#upsert-instance_method" title="Google::Cloud::Spanner::Transaction#upsert (method)">Transaction#upsert</a></span> (See <span class='object_link'><a href="#transaction-instance_method" title="Google::Cloud::Spanner::Client#transaction (method)">#transaction</a></span>). This method makes a single
RPC, whereas <span class='object_link'><a href="Transaction.html#upsert-instance_method" title="Google::Cloud::Spanner::Transaction#upsert (method)">Transaction#upsert</a></span> requires two RPCs (one of which may
be performed in advance), and so this method may be appropriate for
latency sensitive and/or high throughput blind upserts.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/spanner</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_spanner'>spanner</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Spanner.html" title="Google::Cloud::Spanner (module)">Spanner</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Spanner.html#new-class_method" title="Google::Cloud::Spanner.new (method)">new</a></span></span>

<span class='id identifier rubyid_db'>db</span> <span class='op'>=</span> <span class='id identifier rubyid_spanner'>spanner</span><span class='period'>.</span><span class='id identifier rubyid_client'>client</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-instance</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my-database</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_db'>db</span><span class='period'>.</span><span class='id identifier rubyid_upsert'>upsert</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>users</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>1</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Charlie</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>active:</span> <span class='kw'>false</span> <span class='rbrace'>}</span><span class='comma'>,</span>
                    <span class='lbrace'>{</span> <span class='label'>id:</span> <span class='int'>2</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Harvey</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>  <span class='label'>active:</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rbracket'>]</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>table</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The name of the table in the database to be
modified.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rows</span>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>One or more hash objects with the hash keys
matching the table&#39;s columns, and the hash values matching the
table&#39;s values.</p>

<p>Ruby types are mapped to Spanner types as follows:</p>

<table><thead>
<tr>
<th>Spanner</th>
<th>Ruby</th>
<th>Notes</th>
</tr>
</thead><tbody>
<tr>
<td><code>BOOL</code></td>
<td><code>true</code>/<code>false</code></td>
<td></td>
</tr>
<tr>
<td><code>INT64</code></td>
<td><code>Integer</code></td>
<td></td>
</tr>
<tr>
<td><code>FLOAT64</code></td>
<td><code>Float</code></td>
<td></td>
</tr>
<tr>
<td><code>STRING</code></td>
<td><code>String</code></td>
<td></td>
</tr>
<tr>
<td><code>DATE</code></td>
<td><code>Date</code></td>
<td></td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td><code>Time</code>, <code>DateTime</code></td>
<td></td>
</tr>
<tr>
<td><code>BYTES</code></td>
<td><code>File</code>, <code>IO</code>, <code>StringIO</code>, or similar</td>
<td></td>
</tr>
<tr>
<td><code>ARRAY</code></td>
<td><code>Array</code></td>
<td>Nested arrays are not supported.</td>
</tr>
</tbody></table>

<p>See <a href="https://cloud.google.com/spanner/docs/data-definition-language#data_types">Data
types</a>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The timestamp at which the operation committed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


671
672
673
674
675</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/spanner/client.rb', line 671</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upsert'>upsert</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_rows'>rows</span>
  <span class='ivar'>@pool</span><span class='period'>.</span><span class='id identifier rubyid_with_session'>with_session</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_session'>session</span><span class='op'>|</span>
    <span class='id identifier rubyid_session'>session</span><span class='period'>.</span><span class='id identifier rubyid_upsert'>upsert</span> <span class='id identifier rubyid_table'>table</span><span class='comma'>,</span> <span class='id identifier rubyid_rows'>rows</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
