---
layout: yard_main
title: "Class: Google::Cloud::Logging::AsyncWriter - Stackdriver"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::Logging::AsyncWriter";
  relpath = '../../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Logging.html" title="Google::Cloud::Logging (module)">Logging</a></span></span>
     &raquo; 
    <span class="title">AsyncWriter</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Class: Google::Cloud::Logging::AsyncWriter
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Google::Cloud::Logging::AsyncWriter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>MonitorMixin</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/logging/async_writer.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h1>AsyncWriter</h1>

<p>AsyncWriter buffers, batches, and transmits log entries efficiently.
Writing log entries is asynchronous and will not block.</p>

<p>Batches that cannot be delivered immediately are queued. When the queue
is full new batch requests will raise errors that can be consumed using
the <span class='object_link'><a href="#on_error-instance_method" title="Google::Cloud::Logging::AsyncWriter#on_error (method)">#on_error</a></span> callback. This provides back pressure in case the writer
cannot keep up with requests.</p>

<p>This object is thread-safe; it may accept write requests from
multiple threads simultaneously, and will serialize them when
executing in the background thread.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/logging</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_logging'>logging</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Logging.html" title="Google::Cloud::Logging (module)">Logging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Logging.html#new-class_method" title="Google::Cloud::Logging.new (method)">new</a></span></span>

<span class='id identifier rubyid_async'>async</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_async_writer'>async_writer</span>

<span class='id identifier rubyid_entry1'>entry1</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_entry'>entry</span> <span class='label'>payload:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Job started.</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_entry2'>entry2</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_entry'>entry</span> <span class='label'>payload:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Job completed.</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_labels'>labels</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>job_size:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>large</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>job_code:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>red</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
<span class='id identifier rubyid_resource'>resource</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gae_app</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>module_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>version_id</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20150925t173233</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_write_entries'>write_entries</span> <span class='lbracket'>[</span><span class='id identifier rubyid_entry1'>entry1</span><span class='comma'>,</span> <span class='id identifier rubyid_entry2'>entry2</span><span class='rbracket'>]</span><span class='comma'>,</span>
                    <span class='label'>log_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_app_log</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                    <span class='label'>resource:</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span>
                    <span class='label'>labels:</span> <span class='id identifier rubyid_labels'>labels</span></code></pre>
    
  </div>


</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush-instance_method" title="#flush (instance method)">#<strong>flush</strong>  &#x21d2; AsyncWriter </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Forces all entries in the current batch to be published immediately.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_error-instance_method" title="#last_error (instance method)">#<strong>last_error</strong>  &#x21d2; Exception<sup>?</sup> </a>
    

    
      (also: #last_exception)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The most recent unhandled error to occur while transmitting log entries.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logger-instance_method" title="#logger (instance method)">#<strong>logger</strong>(log_name, resource, labels = {})  &#x21d2; Google::Cloud::Logging::Logger </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a logger instance that is API-compatible with Ruby&#39;s standard library <a href="http://ruby-doc.org/stdlib/libdoc/logger/rdoc">Logger</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_error-instance_method" title="#on_error (instance method)">#<strong>on_error</strong> {|callback| ... } &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Register to be notified of errors when raised.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#started%3F-instance_method" title="#started? (instance method)">#<strong>started?</strong>  &#x21d2; boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Whether the writer has been started.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">#<strong>stop</strong>  &#x21d2; AsyncWriter </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Begins the process of stopping the writer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop!-instance_method" title="#stop! (instance method)">#<strong>stop!</strong>(timeout = nil, force: nil)  &#x21d2; Symbol </a>
    

    
      (also: #async_stop!)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Stop this asynchronous writer and block until it has been stopped.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stopped%3F-instance_method" title="#stopped? (instance method)">#<strong>stopped?</strong>  &#x21d2; boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Whether the writer has been stopped.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#wait!-instance_method" title="#wait! (instance method)">#<strong>wait!</strong>(timeout = nil)  &#x21d2; AsyncWriter </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Blocks until the writer is fully stopped, all pending entries have been published, and all callbacks have completed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write_entries-instance_method" title="#write_entries (instance method)">#<strong>write_entries</strong>(entries, log_name: nil, resource: nil, labels: nil)  &#x21d2; Google::Cloud::Logging::AsyncWriter </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Asynchronously write one or more log entries to the Stackdriver Logging service.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="flush-instance_method">
  
    #<strong>flush</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">AsyncWriter</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Forces all entries in the current batch to be published
immediately.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">AsyncWriter</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>returns self so calls can be chained.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


272
273
274
275
276
277
278
279</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 272</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flush'>flush</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_publish_batch!'>publish_batch!</span>
    <span class='ivar'>@cond</span><span class='period'>.</span><span class='id identifier rubyid_broadcast'>broadcast</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="last_error-instance_method">
  
    #<strong>last_error</strong>  &#x21d2; <tt>Exception</tt><sup>?</sup> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='last_exception-instance_method'>last_exception</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The most recent unhandled error to occur while transmitting log
entries.</p>

<p>If an unhandled error has occurred the subscriber will attempt to
recover from the error and resume buffering, batching, and
transmitting log entries.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/logging</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_logging'>logging</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Logging.html" title="Google::Cloud::Logging (module)">Logging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Logging.html#new-class_method" title="Google::Cloud::Logging.new (method)">new</a></span></span>

<span class='id identifier rubyid_resource'>resource</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gae_app</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='label'>module_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='label'>version_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20150925t173233</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_async'>async</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_async_writer'>async_writer</span>

<span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_app_log</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='label'>env:</span> <span class='symbol'>:production</span>
<span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Job started.</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># If an error was raised, it can be retrieved here:
</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_last_error'>last_error</span> <span class='comment'>#=&gt; nil</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Exception</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>error The most recent error raised.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


363
364
365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 363</span>

<span class='kw'>def</span> <span class='id identifier rubyid_last_error'>last_error</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@last_error</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="logger-instance_method">
  
    #<strong>logger</strong>(log_name, resource, labels = {})  &#x21d2; <tt><span class='object_link'><a href="Logger.html" title="Google::Cloud::Logging::Logger (class)">Google::Cloud::Logging::Logger</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a logger instance that is API-compatible with Ruby&#39;s standard
library <a href="http://ruby-doc.org/stdlib/libdoc/logger/rdoc">Logger</a>.</p>

<p>The logger will use AsyncWriter to transmit log entries on a
background thread.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/logging</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_logging'>logging</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Logging.html" title="Google::Cloud::Logging (module)">Logging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Logging.html#new-class_method" title="Google::Cloud::Logging.new (method)">new</a></span></span>

<span class='id identifier rubyid_resource'>resource</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gae_app</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='label'>module_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='label'>version_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20150925t173233</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_async'>async</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_async_writer'>async_writer</span>
<span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_app_log</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='label'>env:</span> <span class='symbol'>:production</span>
<span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Job started.</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>log_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A log resource name to be associated with the
written log entries.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>resource</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Resource.html" title="Google::Cloud::Logging::Resource (class)">Google::Cloud::Logging::Resource</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The monitored
resource to be associated with written log entries.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>labels</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>A set of user-defined data to be associated with
written log entries.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Logger.html" title="Google::Cloud::Logging::Logger (class)">Google::Cloud::Logging::Logger</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a Logger object that can be
used in place of a ruby standard library logger object.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


195
196
197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 195</span>

<span class='kw'>def</span> <span class='id identifier rubyid_logger'>logger</span> <span class='id identifier rubyid_log_name'>log_name</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_labels'>labels</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'><span class='object_link'><a href="Logger.html" title="Google::Cloud::Logging::Logger (class)">Logger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Logging.html#new-class_method" title="Google::Cloud::Logging.new (method)">new</a></span></span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_log_name'>log_name</span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='id identifier rubyid_labels'>labels</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="on_error-instance_method">
  
    #<strong>on_error</strong> {|callback| ... } &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Register to be notified of errors when raised.</p>

<p>If an unhandled error has occurred the writer will attempt to
recover from the error and resume buffering, batching, and
transmitting log entries</p>

<p>Multiple error handlers can be added.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/logging</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/error_reporting</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_logging'>logging</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Logging.html" title="Google::Cloud::Logging (module)">Logging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Logging.html#new-class_method" title="Google::Cloud::Logging.new (method)">new</a></span></span>

<span class='id identifier rubyid_resource'>resource</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gae_app</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='label'>module_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                            <span class='label'>version_id:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20150925t173233</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_async'>async</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_async_writer'>async_writer</span>

<span class='comment'># Register to be notified when unhandled errors occur.
</span><span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_on_error'>on_error</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_error'>error</span><span class='op'>|</span>
  <span class='comment'># error can be a AsyncWriterError or AsyncWriteEntriesError
</span>  <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'>ErrorReporting</span><span class='period'>.</span><span class='id identifier rubyid_report'>report</span> <span class='id identifier rubyid_error'>error</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_logger'>logger</span> <span class='op'>=</span> <span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_app_log</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_resource'>resource</span><span class='comma'>,</span> <span class='label'>env:</span> <span class='symbol'>:production</span>
<span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Job started.</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>

<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>callback</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The block to be called when an error is raised.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>error</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The error raised.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


330
331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 330</span>

<span class='kw'>def</span> <span class='id identifier rubyid_on_error'>on_error</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@error_callbacks</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_block'>block</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="started?-instance_method">
  
    #<strong>started?</strong>  &#x21d2; <tt>boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Whether the writer has been started.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p><code>true</code> when started, <code>false</code> otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 285</span>

<span class='kw'>def</span> <span class='id identifier rubyid_started?'>started?</span>
  <span class='op'>!</span><span class='id identifier rubyid_stopped?'>stopped?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    #<strong>stop</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">AsyncWriter</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Begins the process of stopping the writer. Entries already in the
queue will be published, but no new entries can be added. Use <span class='object_link'><a href="#wait!-instance_method" title="Google::Cloud::Logging::AsyncWriter#wait! (method)">#wait!</a></span>
to block until the writer is fully stopped and all pending entries
have been published.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">AsyncWriter</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>returns self so calls can be chained.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208
209
210
211
212
213
214
215
216
217</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>break</span> <span class='kw'>if</span> <span class='ivar'>@stopped</span>

    <span class='ivar'>@stopped</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_publish_batch!'>publish_batch!</span>
    <span class='ivar'>@cond</span><span class='period'>.</span><span class='id identifier rubyid_broadcast'>broadcast</span>
    <span class='ivar'>@thread_pool</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span> <span class='kw'>if</span> <span class='ivar'>@thread_pool</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop!-instance_method">
  
    #<strong>stop!</strong>(timeout = nil, force: nil)  &#x21d2; <tt>Symbol</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='async_stop!-instance_method'>async_stop!</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Stop this asynchronous writer and block until it has been stopped.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Number</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Timeout in seconds.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>force</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>If set to true, and the writer hasn&#39;t stopped
within the given timeout, kill it forcibly by terminating the
thread. This should be used with extreme caution, as it can
leave RPCs unfinished. Default is false.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Returns <code>:stopped</code> if the AsyncWriter was already
stopped at the time of invocation, <code>:waited</code> if it stopped
during the timeout period, <code>:timeout</code> if it is still running
after the timeout, or <code>:forced</code> if it was forcibly killed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253
254
255
256
257
258
259
260
261
262
263
264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop!'>stop!</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='kw'>nil</span>
  <span class='kw'>return</span> <span class='symbol'>:stopped</span> <span class='kw'>if</span> <span class='id identifier rubyid_stopped?'>stopped?</span>

  <span class='id identifier rubyid_stop'>stop</span>
  <span class='id identifier rubyid_wait!'>wait!</span> <span class='id identifier rubyid_timeout'>timeout</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@thread_pool</span><span class='period'>.</span><span class='id identifier rubyid_shutdown?'>shutdown?</span> <span class='rbrace'>}</span>
    <span class='kw'>return</span> <span class='symbol'>:waited</span> <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_force'>force</span>
    <span class='ivar'>@thread_pool</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>
    <span class='kw'>return</span> <span class='symbol'>:forced</span>
  <span class='kw'>end</span>
  <span class='symbol'>:timeout</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stopped?-instance_method">
  
    #<strong>stopped?</strong>  &#x21d2; <tt>boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Whether the writer has been stopped.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p><code>true</code> when stopped, <code>false</code> otherwise.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stopped?'>stopped?</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='lbrace'>{</span> <span class='ivar'>@stopped</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="wait!-instance_method">
  
    #<strong>wait!</strong>(timeout = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">AsyncWriter</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Blocks until the writer is fully stopped, all pending entries have
been published, and all callbacks have completed. Does not stop the
writer. To stop the writer, first call <span class='object_link'><a href="#stop-instance_method" title="Google::Cloud::Logging::AsyncWriter#stop (method)">#stop</a></span> and then call <span class='object_link'><a href="#wait!-instance_method" title="Google::Cloud::Logging::AsyncWriter#wait! (method)">#wait!</a></span>
to block until the writer is stopped.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">AsyncWriter</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>returns self so calls can be chained.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


226
227
228
229
230
231
232
233
234
235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 226</span>

<span class='kw'>def</span> <span class='id identifier rubyid_wait!'>wait!</span> <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='ivar'>@thread_pool</span>
      <span class='ivar'>@thread_pool</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span>
      <span class='ivar'>@thread_pool</span><span class='period'>.</span><span class='id identifier rubyid_wait_for_termination'>wait_for_termination</span> <span class='id identifier rubyid_timeout'>timeout</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_entries-instance_method">
  
    #<strong>write_entries</strong>(entries, log_name: nil, resource: nil, labels: nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">Google::Cloud::Logging::AsyncWriter</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Asynchronously write one or more log entries to the Stackdriver
Logging service.</p>

<p>Unlike the main write_entries method, this method usually does not
block. The actual write RPCs will happen in the background, and may
be batched with related calls. However, if the queue is full, this
method will block until enough space has cleared out.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/logging</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_logging'>logging</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Logging.html" title="Google::Cloud::Logging (module)">Logging</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../Logging.html#new-class_method" title="Google::Cloud::Logging.new (method)">new</a></span></span>
<span class='id identifier rubyid_async'>async</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_async_writer'>async_writer</span>

<span class='id identifier rubyid_entry'>entry</span> <span class='op'>=</span> <span class='id identifier rubyid_logging'>logging</span><span class='period'>.</span><span class='id identifier rubyid_entry'>entry</span> <span class='label'>payload:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Job started.</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                      <span class='label'>log_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_app_log</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gae_app</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='lbracket'>[</span><span class='symbol'>:module_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='lbracket'>[</span><span class='symbol'>:version_id</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>20150925t173233</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_async'>async</span><span class='period'>.</span><span class='id identifier rubyid_write_entries'>write_entries</span> <span class='id identifier rubyid_entry'>entry</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>entries</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Entry.html" title="Google::Cloud::Logging::Entry (class)">Google::Cloud::Logging::Entry</a></span></tt>, <tt>Array&lt;<span class='object_link'><a href="Entry.html" title="Google::Cloud::Logging::Entry (class)">Google::Cloud::Logging::Entry</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>One or more entry
objects to write. The log entries must have values for all required
fields.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>log_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A default log ID for those log entries in
<code>entries</code> that do not specify their own <code>log_name</code>. See also
<span class='object_link'><a href="Entry.html#log_name=-instance_method" title="Google::Cloud::Logging::Entry#log_name= (method)">Entry#log_name=</a></span>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>resource</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Resource.html" title="Google::Cloud::Logging::Resource (class)">Resource</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A default monitored resource for those log
entries in entries that do not specify their own resource. See also
<span class='object_link'><a href="Entry.html#resource-instance_method" title="Google::Cloud::Logging::Entry#resource (method)">Entry#resource</a></span>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>labels</span>
      
      
        <span class='type'>(<tt>Hash{Symbol,String =&gt; String}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>User-defined <code>key:value</code>
items that are added to the <code>labels</code> field of each log entry in
<code>entries</code>, except when a log entry specifies its own <code>key:value</code>
item with the same key. See also <span class='object_link'><a href="Entry.html#labels=-instance_method" title="Google::Cloud::Logging::Entry#labels= (method)">Entry#labels=</a></span>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Google::Cloud::Logging::AsyncWriter (class)">Google::Cloud::Logging::AsyncWriter</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Returns self.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/logging/async_writer.rb', line 132</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_entries'>write_entries</span> <span class='id identifier rubyid_entries'>entries</span><span class='comma'>,</span> <span class='label'>log_name:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>resource:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>labels:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AsyncWriter has been stopped</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@stopped</span>

    <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_entries'>entries</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>
      <span class='comment'># Update the entry to have all the data directly on it
</span>      <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_log_name'>log_name</span> <span class='op'>||=</span> <span class='id identifier rubyid_log_name'>log_name</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
        <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_resource'>resource</span> <span class='op'>=</span> <span class='id identifier rubyid_resource'>resource</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span> <span class='op'>=</span> <span class='id identifier rubyid_labels'>labels</span> <span class='kw'>if</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

      <span class='comment'># Add the entry to the batch
</span>      <span class='ivar'>@batch</span> <span class='op'>||=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>self</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_try_add'>try_add</span> <span class='id identifier rubyid_entry'>entry</span>

      <span class='comment'># If we can&#39;t add to the batch, publish and create a new batch
</span>      <span class='id identifier rubyid_publish_batch!'>publish_batch!</span>
      <span class='ivar'>@batch</span> <span class='op'>=</span> <span class='const'>Batch</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>self</span>
      <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span> <span class='id identifier rubyid_entry'>entry</span>
    <span class='kw'>end</span>

    <span class='ivar'>@thread_pool</span> <span class='op'>||=</span> <span class='const'>Concurrent</span><span class='op'>::</span><span class='const'>ThreadPoolExecutor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> \
      <span class='label'>max_threads:</span> <span class='ivar'>@threads</span><span class='comma'>,</span> <span class='label'>max_queue:</span> <span class='ivar'>@max_queue</span>
    <span class='ivar'>@thread</span> <span class='op'>||=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_run_background'>run_background</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_publish_batch!'>publish_batch!</span> <span class='kw'>if</span> <span class='ivar'>@batch</span><span class='period'>.</span><span class='id identifier rubyid_ready?'>ready?</span>

    <span class='ivar'>@cond</span><span class='period'>.</span><span class='id identifier rubyid_broadcast'>broadcast</span>
  <span class='kw'>end</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
