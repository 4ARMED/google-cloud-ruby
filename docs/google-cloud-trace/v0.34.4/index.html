---
layout: yard_main
title: "File: OVERVIEW - Stackdriver"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "OVERVIEW";
  relpath = '';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: OVERVIEW</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><div id='filecontents'><h1>Stackdriver Trace</h1>

<p>The Stackdriver Trace service collects and stores latency data from your
application and displays it in the Google Cloud Platform Console, giving
you detailed near-real-time insight into application performance.</p>

<p>The Stackdriver Trace Ruby library, <code>google-cloud-trace</code>, provides:</p>

<ul>
<li>  Easy-to-use trace instrumentation that collects and collates latency
data for your Ruby application. If you just want latency trace data
for your application to appear on the Google Cloud Platform Console,
see the section on <a href="#instrumenting-your-app">instrumenting your app</a>.</li>
<li>  An idiomatic Ruby API for querying, analyzing, and manipulating trace
data in your Ruby application. For an introduction to the Trace API,
see the section on the <a href="#stackdriver-trace-api">Trace API</a>.</li>
</ul>

<h2>Instrumenting Your App</h2>

<p>This library integrates with Rack-based web frameworks such as Ruby On
Rails to provide latency trace reports for your application.
Specifcally, it:</p>

<ul>
<li>  Provides a Rack middleware that automatically reports latency traces
for http requests handled by your application, and measures the
latency of each request as a whole.</li>
<li>  Integrates with <code>ActiveSupport::Notifications</code> to add important
latency-affecting events such as ActiveRecord queries to the trace.</li>
<li>  Provides a simple API for your application code to define and
measure latency-affecting processes specific to your application.</li>
</ul>

<p>When this library is installed and configured in your running
application, you can view your application&#39;s latency traces in real time
by opening the Google Cloud Console in your web browser and navigating
to the &quot;Trace&quot; section. It also integrates with Google App Engine
Flexible and Google Container Engine to provide additional information
for applications hosted in those environments.</p>

<p>Note that not all requests will have traces. By default, the library will
sample about one trace every ten seconds per Ruby process, to prevent
heavily used applications from reporting too much data. It will also
omit certain requests used by Google App Engine for health checking. See
<span class='object_link'><a href="Google/Cloud/Trace/TimeSampler.html" title="Google::Cloud::Trace::TimeSampler (class)">Google::Cloud::Trace::TimeSampler</a></span> for more details.</p>

<h3>Using instrumentation with Ruby on Rails</h3>

<p>To install application instrumentation in your Ruby on Rails app, add
this gem, <code>google-cloud-trace</code>, to your Gemfile and update your bundle.
Then add the following line to your <code>config/application.rb</code> file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace/rails</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>This will install a Railtie that automatically integrates with the
Rails framework, installing the middleware and the ActiveSupport
integration for you. Your application traces, including basic request
tracing, ActiveRecord query measurements, and view render measurements,
should then start appearing in the Cloud Console.</p>

<p>See the <span class='object_link'><a href="Google/Cloud/Trace/Railtie.html" title="Google::Cloud::Trace::Railtie (class)">Google::Cloud::Trace::Railtie</a></span> class for more information,
including how to customize your application traces.</p>

<h3>Using instrumentation with Sinatra</h3>

<p>To install application instrumentation in your Sinatra app, add this gem,
<code>google-cloud-trace</code>, to your Gemfile and update your bundle. Then add
the following lines to your main application Ruby file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_use'>use</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace.html" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span></span>
</code></pre>

<p>This will install the trace middleware in your application, providing
basic request tracing for your application. You may measure additional
processes such as database queries or calls to external services using
other classes in this library. See the <span class='object_link'><a href="Google/Cloud/Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Google::Cloud::Trace::Middleware</a></span>
documentation for more information.</p>

<h3>Using instrumentation with other Rack-based frameworks</h3>

<p>To install application instrumentation in an app using another Rack-based
web framework, add this gem, <code>google-cloud-trace</code>, to your Gemfile and
update your bundle. Then add install the trace middleware in your
middleware stack. In most cases, this means adding these lines to your
<code>config.ru</code> Rack configuration file:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_use'>use</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace.html" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span></span>
</code></pre>

<p>Some web frameworks have an alternate mechanism for modifying the
middleware stack. Consult your web framework&#39;s documentation for more
information.</p>

<h3>The Stackdriver diagnostics suite</h3>

<p>The trace library is part of the Stackdriver diagnostics suite, which
also includes error reporting and log analysis. If you include the
<code>stackdriver</code> gem in your Gemfile, this trace library will be included
automatically. In addition, if you include the <code>stackdriver</code> gem in an
application using Ruby On Rails, the Railtie will be installed
automatically; you will not need to write any code to view latency
traces for your appl. See the documentation for the &quot;stackdriver&quot; gem
for more details.</p>

<h2>Stackdriver Trace API</h2>

<p>This library also includes an easy to use Ruby client for the
Stackdriver Trace API. This API provides calls to report and modify
application traces, as well as to query and analyze existing traces.</p>

<p>For further information on the trace API, see
<span class='object_link'><a href="Google/Cloud/Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Google::Cloud::Trace::Project</a></span>.</p>

<h3>Querying traces using the API</h3>

<p>Using the Stackdriver Trace API, your application can query and analyze
its own traces and traces of other projects. Here is an example query
for all traces in the past hour.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace.html" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Google/Cloud/Trace.html#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>

<span class='id identifier rubyid_traces'>traces</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_list_traces'>list_traces</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>3600</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
<span class='id identifier rubyid_traces'>traces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_trace'>trace</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrieved trace ID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_trace_id'>trace_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Each trace is an object of type <span class='object_link'><a href="Google/Cloud/Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">Google::Cloud::Trace::TraceRecord</a></span>,
which provides methods for analyzing tasks that took place during the
request trace. See <a href="https://cloud.google.com/trace">https://cloud.google.com/trace</a> for more information
on the kind of data you can capture in a trace.</p>

<h3>Reporting traces using the API</h3>

<p>Usually it is easiest to use this library&#39;s trace instrumentation
features to collect and record application trace information. However,
you may also use the trace API to update this data. Here is an example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace.html" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Google/Cloud/Trace.html#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>

<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Google/Cloud/Trace.html" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Google/Cloud/Trace.html#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>root_span</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='comment'># Do stuff...
</span><span class='kw'>end</span>

<span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_patch_traces'>patch_traces</span> <span class='id identifier rubyid_trace'>trace</span>
</code></pre>

<h2>Additional information</h2>

<p>Stackdriver Trace can be configured to be used in Rack applications or to use
gRPC&#39;s logging. To learn more, see the <a href="file.INSTRUMENTATION.html" title="Instrumentation Guide">Instrumentation Guide</a> and <a href="file.LOGGING.html" title="Logging guide">Logging guide</a>.</p>
</div></div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
