---
layout: yard_main
title: "Module: Google::Cloud::Trace - Stackdriver"
css: 
  - /docs/css/style.css
  - /docs/css/common.css
  - /css/yard-main.css
js: 
  - /docs/js/app.js
  - /js/yard-main.js
---
<script type="text/javascript" charset="utf-8">
  pathId = "Google::Cloud::Trace";
  relpath = '../../';
</script>


<div class="nav_wrap">
  <iframe id="nav" src="../../class_list.html?1"></iframe>
  <div id="resizer"></div>
</div>

<div id="main" tabindex="-1">
  <div id="header">
    <div id="menu">
  
    <a href="../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span>
     &raquo; 
    <span class="title">Trace</span>
  
</div>

    <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
    <div class="clear"></div>
  </div>

  <div id="content"><h1>Module: Google::Cloud::Trace
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/google/cloud/trace.rb<span class="defines">,<br />
  lib/google/cloud/trace/v2.rb,<br /> lib/google/cloud/trace/span.rb,<br /> lib/google/cloud/trace/rails.rb,<br /> lib/google/cloud/trace/utils.rb,<br /> lib/google/cloud/trace/errors.rb,<br /> lib/google/cloud/trace/project.rb,<br /> lib/google/cloud/trace/service.rb,<br /> lib/google/cloud/trace/version.rb,<br /> lib/google/cloud/trace/label_key.rb,<br /> lib/google/cloud/trace/span_kind.rb,<br /> lib/google/cloud/trace/middleware.rb,<br /> lib/google/cloud/trace/result_set.rb,<br /> lib/google/cloud/trace/credentials.rb,<br /> lib/google/cloud/trace/time_sampler.rb,<br /> lib/google/cloud/trace/trace_record.rb,<br /> lib/google/cloud/trace/notifications.rb,<br /> lib/google/cloud/trace/async_reporter.rb,<br /> lib/google/cloud/trace/v1/credentials.rb,<br /> lib/google/cloud/trace/v2/credentials.rb,<br /> lib/google/cloud/trace/faraday_middleware.rb,<br /> lib/google/cloud/trace/v1/trace_service_client.rb,<br /> lib/google/cloud/trace/v2/trace_service_client.rb</span>
</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <h1>Ruby Client for Stackdriver Trace API (<a href="https://github.com/googleapis/google-cloud-ruby#versioning">Alpha</a>)</h1>

<p><a href="https://cloud.google.com/trace">Stackdriver Trace API</a>:
Sends application trace data to Stackdriver Trace for viewing. Trace data is
collected for all App Engine applications by default. Trace data from other
applications can be provided using this API.</p>

<ul>
<li><a href="https://cloud.google.com/trace">Product Documentation</a></li>
</ul>

<h2>Quick Start</h2>

<p>In order to use this library, you first need to go through the following
steps:</p>

<ol>
<li><a href="https://console.cloud.google.com/project">Select or create a Cloud Platform project.</a></li>
<li><a href="https://cloud.google.com/billing/docs/how-to/modify-project#enable_billing_for_a_project">Enable billing for your project.</a></li>
<li><a href="https://console.cloud.google.com/apis/api/trace">Enable the Stackdriver Trace API.</a></li>
<li><a href="https://googleapis.github.io/google-cloud-ruby/#/docs/google-cloud/master/guides/authentication">Setup Authentication.</a></li>
</ol>

<h3>Preview</h3>

<h4>TraceServiceClient</h4>

<pre class="code rb"><code class="rb">require &quot;google/cloud/trace/v2&quot;

trace_service_client = Google::Cloud::Trace::V2.new
formatted_name = Google::Cloud::Trace::V2::TraceServiceClient.project_path(project_id)
spans = []
trace_service_client.batch_write_spans(formatted_name, spans)
</code></pre>

<h3>Next Steps</h3>

<ul>
<li>Read the <a href="https://cloud.google.com/trace">Stackdriver Trace API Product documentation</a>
to learn more about the product and see How-to Guides.</li>
<li>View this <a href="https://github.com/googleapis/google-cloud-ruby/blob/master/README.md">repository&#39;s main README</a>
to see the full list of Cloud APIs that we cover.</li>
</ul>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Trace/LabelKey.html" title="Google::Cloud::Trace::LabelKey (module)">LabelKey</a></span>, <span class='object_link'><a href="Trace/Notifications.html" title="Google::Cloud::Trace::Notifications (module)">Notifications</a></span>, <span class='object_link'><a href="Trace/V1.html" title="Google::Cloud::Trace::V1 (module)">V1</a></span>, <span class='object_link'><a href="Trace/V2.html" title="Google::Cloud::Trace::V2 (module)">V2</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Trace/AsyncPatchTracesError.html" title="Google::Cloud::Trace::AsyncPatchTracesError (class)">AsyncPatchTracesError</a></span>, <span class='object_link'><a href="Trace/AsyncReporterError.html" title="Google::Cloud::Trace::AsyncReporterError (class)">AsyncReporterError</a></span>, <span class='object_link'><a href="Trace/Credentials.html" title="Google::Cloud::Trace::Credentials (class)">Credentials</a></span>, <span class='object_link'><a href="Trace/FaradayMiddleware.html" title="Google::Cloud::Trace::FaradayMiddleware (class)">FaradayMiddleware</a></span>, <span class='object_link'><a href="Trace/Middleware.html" title="Google::Cloud::Trace::Middleware (class)">Middleware</a></span>, <span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Project</a></span>, <span class='object_link'><a href="Trace/Railtie.html" title="Google::Cloud::Trace::Railtie (class)">Railtie</a></span>, <span class='object_link'><a href="Trace/ResultSet.html" title="Google::Cloud::Trace::ResultSet (class)">ResultSet</a></span>, <span class='object_link'><a href="Trace/Span.html" title="Google::Cloud::Trace::Span (class)">Span</a></span>, <span class='object_link'><a href="Trace/SpanKind.html" title="Google::Cloud::Trace::SpanKind (class)">SpanKind</a></span>, <span class='object_link'><a href="Trace/TimeSampler.html" title="Google::Cloud::Trace::TimeSampler (class)">TimeSampler</a></span>, <span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">TraceRecord</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="THREAD_KEY-constant" class="">THREAD_KEY =
          
        </dt>
        <dd><pre class="code"><span class='symbol'>:__stackdriver_trace_span__</span></pre></dd>
      
        <dt id="VERSION-constant" class="">VERSION =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0.34.4</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure-class_method" title="configure (class method)">.<strong>configure</strong> {|Google::Cloud.configure.trace| ... } &#x21d2; Google::Cloud::Config </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Configure the Stackdriver Trace instrumentation Middleware.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-class_method" title="get (class method)">.<strong>get</strong>  &#x21d2; Google::Cloud::Trace::TraceSpan, ... </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Retrieve the current trace span or trace object for the current thread.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#in_span-class_method" title="in_span (class method)">.<strong>in_span</strong>(name, kind: Google::Cloud::Trace::SpanKind::UNSPECIFIED, labels: {})  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Open a new span for the current thread, instrumenting the given block.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-class_method" title="new (class method)">.<strong>new</strong>(project_id: nil, credentials: nil, scope: nil, timeout: nil, client_config: nil, project: nil, keyfile: nil)  &#x21d2; Google::Cloud::Trace::Project </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new object for connecting to the Stackdriver Trace service.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set-class_method" title="set (class method)">.<strong>set</strong>(trace)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set the current trace span being measured for the current thread, or the current trace if no span is currently open.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="configure-class_method">
  
    .<strong>configure</strong> {|Google::Cloud.configure.trace| ... } &#x21d2; <tt>Google::Cloud::Config</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Configure the Stackdriver Trace instrumentation Middleware.</p>

<p>The following Stackdriver Trace configuration parameters are
supported:</p>

<ul>
<li><code>project_id</code> - (String) Project identifier for the Stackdriver
Trace service you are connecting to. (The parameter <code>project</code> is
considered deprecated, but may also be used.)</li>
<li><code>credentials</code> - (String, Hash, Google::Auth::Credentials) The path to
the keyfile as a String, the contents of the keyfile as a Hash, or a
Google::Auth::Credentials object. (See <span class='object_link'><a href="Trace/Credentials.html" title="Google::Cloud::Trace::Credentials (class)">Credentials</a></span>) (The
parameter <code>keyfile</code> is considered deprecated, but may also be used.)</li>
<li><code>scope</code> - (String, Array<String>) The OAuth 2.0 scopes controlling
the set of resources and operations that the connection can access.</li>
<li><code>timeout</code> - (Integer) Default timeout to use in requests.</li>
<li><code>client_config</code> - (Hash) A hash of values to override the default
behavior of the API client.</li>
<li><code>capture_stack</code> - (Boolean) Whether to capture stack traces for each
span. Default: <code>false</code></li>
<li><code>sampler</code> - (Proc) A sampler Proc makes the decision whether to record
a trace for each request. Default: <code>Google::Cloud::Trace::TimeSampler</code></li>
<li><code>span_id_generator</code> - (Proc) A generator Proc that generates the name
String for new TraceRecord. Default: <code>random numbers</code></li>
<li><code>notifications</code> - (Array) An array of ActiveSupport notification types
to include in traces. Rails-only option. Default:
<code>Google::Cloud::Trace::Railtie::DEFAULT_NOTIFICATIONS</code></li>
<li><code>max_data_length</code> - (Integer) The maximum length of span properties
recorded with ActiveSupport notification events. Rails-only option.
Default:
<code>Google::Cloud::Trace::Notifications::DEFAULT_MAX_DATA_LENGTH</code></li>
<li><code>on_error</code> - (Proc) A Proc to be run when an error is encountered
during the reporting of traces by the middleware. The Proc must take
the error object as the single argument.</li>
</ul>

<p>See the <a href="../../file.INSTRUMENTATION.html" title="Configuration Guide">Configuration Guide</a> for full
configuration parameters.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Google::Cloud</a></span>.<span class='object_link'><a href="#configure-class_method" title="Google::Cloud::Trace.configure (method)">configure</a></span>.<span class='object_link'><a href="../Cloud.html#trace-class_method" title="Google::Cloud.trace (method)">trace</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Google::Cloud::Config</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The configuration object
the Google::Cloud::Trace module uses.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 154</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span>
  <span class='kw'>yield</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>

  <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'>configure</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get-class_method">
  
    .<strong>get</strong>  &#x21d2; <tt>Google::Cloud::Trace::TraceSpan</tt>, ... 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Retrieve the current trace span or trace object for the current thread.
This data should previously have been set using
<span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_new_trace'>new_trace</span>
<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'><span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span></span> <span class='id identifier rubyid_trace'>trace</span>

<span class='comment'># Later...
</span><span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='period'>.</span><span class='id identifier rubyid_create_span'><span class='object_link'><a href="Trace/TraceRecord.html#create_span-instance_method" title="Google::Cloud::Trace::TraceRecord#create_span (method)">create_span</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_span</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Google::Cloud::Trace::TraceSpan</tt>, <tt><span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">Google::Cloud::Trace::TraceRecord</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The span or trace object,
or <code>nil</code>.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 222</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#THREAD_KEY-constant" title="Google::Cloud::Trace::THREAD_KEY (constant)">THREAD_KEY</a></span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="in_span-class_method">
  
    .<strong>in_span</strong>(name, kind: Google::Cloud::Trace::SpanKind::UNSPECIFIED, labels: {})  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Open a new span for the current thread, instrumenting the given block.
The span is created within the current thread&#39;s trace context as set by
<span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span>. The context is updated so any further calls
within the block will create subspans. The new span is also yielded to
the block.</p>

<p>Does nothing if there is no trace context for the current thread.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_new_trace'>new_trace</span>
<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'><span class='object_link'><a href="#set-class_method" title="Google::Cloud::Trace.set (method)">set</a></span></span> <span class='id identifier rubyid_trace'>trace</span>

<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_span</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_span'>span</span><span class='op'>|</span>
  <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># Do stuff...
</span>
  <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_subspan</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_subspan'>subspan</span><span class='op'>|</span>
    <span class='id identifier rubyid_subspan'>subspan</span><span class='period'>.</span><span class='id identifier rubyid_labels'>labels</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sub-bar</span><span class='tstring_end'>&quot;</span></span>
    <span class='comment'># Do other stuff...
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Name of the span to create</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>kind</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/SpanKind.html" title="Google::Cloud::Trace::SpanKind (class)">Google::Cloud::Trace::SpanKind</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Kind of span to create.
Optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>labels</span>
      
      
        <span class='type'>(<tt>Hash{String =&gt; String}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Labels for the span</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 257</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/SpanKind.html" title="Google::Cloud::Trace::SpanKind (class)">SpanKind</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/SpanKind.html#UNSPECIFIED-constant" title="Google::Cloud::Trace::SpanKind::UNSPECIFIED (constant)">UNSPECIFIED</a></span></span><span class='comma'>,</span>
                 <span class='label'>labels:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_parent'>parent</span> <span class='op'>=</span> <span class='id identifier rubyid_get'>get</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_parent'>parent</span>
    <span class='id identifier rubyid_parent'>parent</span><span class='period'>.</span><span class='id identifier rubyid_in_span'>in_span</span> <span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>kind:</span> <span class='id identifier rubyid_kind'>kind</span><span class='comma'>,</span> <span class='label'>labels:</span> <span class='id identifier rubyid_labels'>labels</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
      <span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_child'>child</span>
      <span class='kw'>begin</span>
        <span class='kw'>yield</span> <span class='id identifier rubyid_child'>child</span>
      <span class='kw'>ensure</span>
        <span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_parent'>parent</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>yield</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-class_method">
  
    .<strong>new</strong>(project_id: nil, credentials: nil, scope: nil, timeout: nil, client_config: nil, project: nil, keyfile: nil)  &#x21d2; <tt><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Google::Cloud::Trace::Project</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a new object for connecting to the Stackdriver Trace service.
Each call creates a new connection.</p>

<p>For more information on connecting to Google Cloud see the
<a href="../../file.AUTHENTICATION.html" title="Authentication Guide">Authentication Guide</a>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

<span class='id identifier rubyid_traces'>traces</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_list_traces'>list_traces</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='int'>3600</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
<span class='id identifier rubyid_traces'>traces</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_trace'>trace</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Retrieved trace ID: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_trace_id'>trace_id</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>project_id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Project identifier for the Stackdriver Trace
service you are connecting to. If not present, the default project for
the credentials is used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>credentials</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Hash</tt>, <tt>Google::Auth::Credentials</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The path to
the keyfile as a String, the contents of the keyfile as a Hash, or a
Google::Auth::Credentials object. (See <span class='object_link'><a href="Trace/Credentials.html" title="Google::Cloud::Trace::Credentials (class)">Credentials</a></span>)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>scope</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The OAuth 2.0 scopes controlling
the set of resources and operations that the connection can access.
See <a href="https://developers.google.com/identity/protocols/OAuth2">Using OAuth 2.0 to Access Google
APIs</a>.</p>

<p>The default scope is:</p>

<ul>
<li><code>https://www.googleapis.com/auth/cloud-platform</code></li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>timeout</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Default timeout to use in requests. Optional.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>project</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Alias for the <code>project_id</code> argument. Deprecated.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>keyfile</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Alias for the <code>credentials</code> argument.
Deprecated.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Google::Cloud::Trace::Project</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 87</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='label'>project_id:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>credentials:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='kw'>nil</span><span class='comma'>,</span>
             <span class='label'>client_config:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>project:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>keyfile:</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_project_id'>project_id</span>    <span class='op'>||=</span> <span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span> <span class='op'>||</span> <span class='id identifier rubyid_default_project_id'>default_project_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_scope'>scope</span>         <span class='op'>||=</span> <span class='id identifier rubyid_configure'>configure</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span>
  <span class='id identifier rubyid_timeout'>timeout</span>       <span class='op'>||=</span> <span class='id identifier rubyid_configure'>configure</span><span class='period'>.</span><span class='id identifier rubyid_timeout'>timeout</span>
  <span class='id identifier rubyid_client_config'>client_config</span> <span class='op'>||=</span> <span class='id identifier rubyid_configure'>configure</span><span class='period'>.</span><span class='id identifier rubyid_client_config'>client_config</span>
  <span class='id identifier rubyid_credentials'>credentials</span>   <span class='op'>||=</span> <span class='lparen'>(</span><span class='id identifier rubyid_keyfile'>keyfile</span> <span class='op'>||</span> <span class='id identifier rubyid_default_credentials'>default_credentials</span><span class='lparen'>(</span><span class='label'>scope:</span> <span class='id identifier rubyid_scope'>scope</span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'>Auth</span><span class='op'>::</span><span class='const'>Credentials</span>
    <span class='id identifier rubyid_credentials'>credentials</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Credentials.html" title="Google::Cloud::Trace::Credentials (class)">Credentials</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='label'>scope:</span> <span class='id identifier rubyid_scope'>scope</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span> <span class='symbol'>:project_id</span>
    <span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>||=</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='period'>.</span><span class='id identifier rubyid_project_id'>project_id</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_project_id'>project_id</span> <span class='op'>=</span> <span class='id identifier rubyid_project_id'>project_id</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='comment'># Always cast to a string
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>project_id is missing</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_project_id'>project_id</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Trace/Project.html" title="Google::Cloud::Trace::Project (class)">Project</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='op'>::</span><span class='const'>Service</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_project_id'>project_id</span><span class='comma'>,</span> <span class='id identifier rubyid_credentials'>credentials</span><span class='comma'>,</span> <span class='label'>timeout:</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='comma'>,</span>
                               <span class='label'>client_config:</span> <span class='id identifier rubyid_client_config'>client_config</span>
    <span class='rparen'>)</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set-class_method">
  
    .<strong>set</strong>(trace)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set the current trace span being measured for the current thread, or
the current trace if no span is currently open. This may be used with
web frameworks that assign a thread to each request, to track the
trace instrumentation state for the request being handled. You may use
<span class='object_link'><a href="#get-class_method" title="Google::Cloud::Trace.get (method)">get</a></span> to retrieve the data.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
      <pre class="example code"><code><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>google/cloud/trace</span><span class='tstring_end'>&quot;</span></span>

<span class='id identifier rubyid_trace_client'>trace_client</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#new-class_method" title="Google::Cloud::Trace.new (method)">new</a></span></span>
<span class='id identifier rubyid_trace'>trace</span> <span class='op'>=</span> <span class='id identifier rubyid_trace_client'>trace_client</span><span class='period'>.</span><span class='id identifier rubyid_new_trace'>new_trace</span>
<span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace'>trace</span>

<span class='comment'># Later...
</span><span class='const'><span class='object_link'><a href="../../Google.html" title="Google (module)">Google</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cloud.html" title="Google::Cloud (module)">Cloud</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Google::Cloud::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_get'><span class='object_link'><a href="#get-class_method" title="Google::Cloud::Trace.get (method)">get</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create_span'><span class='object_link'><a href="Trace/TraceRecord.html#create_span-instance_method" title="Google::Cloud::Trace::TraceRecord#create_span (method)">create_span</a></span></span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_span</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>trace</span>
      
      
        <span class='type'>(<tt>Google::Cloud::Trace::TraceSpan</tt>, <tt><span class='object_link'><a href="Trace/TraceRecord.html" title="Google::Cloud::Trace::TraceRecord (class)">Google::Cloud::Trace::TraceRecord</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The current span
being measured, the current trace object, or <code>nil</code> if none.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


197
198
199
200
201</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/google/cloud/trace.rb', line 197</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace'>trace</span>
  <span class='id identifier rubyid_trace_context'>trace_context</span> <span class='op'>=</span> <span class='id identifier rubyid_trace'>trace</span> <span class='op'>?</span> <span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_trace_context'>trace_context</span> <span class='op'>:</span> <span class='kw'>nil</span>
  <span class='const'>Stackdriver</span><span class='op'>::</span><span class='const'>Core</span><span class='op'>::</span><span class='const'>TraceContext</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span> <span class='id identifier rubyid_trace_context'>trace_context</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#THREAD_KEY-constant" title="Google::Cloud::Trace::THREAD_KEY (constant)">THREAD_KEY</a></span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_trace'>trace</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

  <div id="footer">
  <ul class="footer-links">
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby" title="Google Cloud on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> GitHub
      </a>
    </li>
    <li>
      <a href="https://github.com/GoogleCloudPlatform/google-cloud-ruby/issues" title="Google Cloud issues on Github">
        <img src="/google-cloud-ruby/img/icon-link-github.svg" alt="GitHub icon"> Issues
      </a>
    </li>
    <li>
      <a href="http://stackoverflow.com/questions/tagged/google-cloud-ruby" title="Google Cloud on StackOverflow">
      <img src="/google-cloud-ruby/img/icon-link-stackoverflow.svg" alt="StackOverflow icon"> StackOverflow
    </a>
    </li>
    <li>
      <a href="http://rubygems.org/gems/google-cloud" title="Google Cloud on RubyGems">
        <img src="/google-cloud-ruby/img/icon-link-package-manager.svg" alt="RubyGems icon"> RubyGems
      </a>
    </li>
  </ul>

  <p>
    Documentation generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>.
  </p>
</div>

</div>
